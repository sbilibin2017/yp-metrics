# Яндекс Практикум "Продвинутый Go Разработчик"  
## Сервис сбора метрик и алертинга

## 📌 Описание проекта

Это система для сбора runtime-метрик, разработанная в рамках трека **«Сервис сбора метрик и алертинга»** курса **«Продвинутый Go-разработчик»** от Яндекс Практикума.  
Состоит из двух компонентов:

- **Сервер** — принимает и хранит метрики;
- **Агент** — собирает метрики из среды выполнения и отправляет их на сервер.

---

## ⚙️ Метрики

Поддерживаются два типа метрик:

- **gauge** (`float64`) — значение перезаписывается при каждом обновлении;
- **counter** (`int64`) — значение увеличивается на заданное при каждом обновлении.

---

## 🌐 Сервер

Сервер слушает `http://localhost:8080` и обрабатывает http запросы  

---

## 🛰 Агент

Агент предназначен для автоматического сбора метрик из стандартной библиотеки `runtime` и их периодической отправки на сервер.

### Что делает агент:

- Использует `runtime.ReadMemStats` для сбора метрик (`Alloc`, `TotalAlloc`, `Sys`, и др.);
- Обновляет значения `counter` метрик (например, количество попыток отправки);
- Отправляет данные на сервер с заданной периодичностью (`pollInterval`, `reportInterval`);
- Работает параллельно, используя `context.Context` и фоновые воркеры.

Агент можно запустить отдельно, указав адрес сервера и частоту опроса/отправки метрик через конфигурацию.

---

## Структура проекта

Проект имеет слоистую архитектуру, взаимодействие слоев осуществляется с помощью интерфейсов


```
.
├── cmd
│   ├── agent                         # Агент — клиентский компонент сбора и отправки метрик
│   │   ├── agent                    # (исполняемый файл или бинарник агента)
│   │   ├── flags.go                 # Определение и обработка CLI-флагов агента
│   │   ├── flags_test.go            # Тесты для флагов агента
│   │   ├── main.go                  # Основной файл запуска агента (точка входа)
│   │   ├── main_test.go             # Тесты для main.go агента
│   │   └── run.go                   # Логика запуска и жизненного цикла агента
│   └── server                       # Сервер — приёмник метрик и API
│       ├── flags.go                 # Определение и обработка CLI-флагов сервера
│       ├── flags_test.go            # Тесты для флагов сервера
│       ├── main.go                  # Основной файл запуска сервера (точка входа)
│       ├── main_test.go             # Тесты для main.go сервера
│       ├── run.go                   # Логика запуска и жизненного цикла сервера
│       └── server                  # (исполняемый файл или бинарник сервера)
├── go.mod                           # Описание зависимостей Go-модуля
├── go.sum                           # Контрольные суммы зависимостей
├── internal                         # Внутренние пакеты (неэкспортируемые за пределы модуля)
│   ├── configs                      # Конфигурации приложения (агента и сервера)
│   │   ├── agent.go                 # Конфигурация агента
│   │   ├── agent_test.go            # Тесты конфигурации агента
│   │   ├── server.go                # Конфигурация сервера
│   │   └── server_test.go           # Тесты конфигурации сервера
│   ├── containers                   # Контейнеры и DI-компоненты для агента и сервера
│   │   ├── agent.go                 # DI-контейнер агента
│   │   ├── agent_test.go            # Тесты DI-контейнера агента
│   │   ├── server.go                # DI-контейнер сервера
│   │   └── server_test.go           # Тесты DI-контейнера сервера
│   ├── facades                     # Фасады — обёртки над внешними компонентами/зависимостями
│   │   ├── metric_update.go         # Фасад отправки метрик от агента на сервер
│   │   └── metric_update_test.go    # Тесты фасада отправки метрик
│   ├── handlers                    # HTTP-обработчики входящих запросов
│   │   ├── metric_get_path.go       # Обработчик получения метрик по URL пути
│   │   ├── metric_get_path_mock.go  # Моки для тестов обработчика получения
│   │   ├── metric_get_path_test.go  # Тесты обработчика получения метрик
│   │   ├── metric_get_body.go       # Обработчик получения метрик в теле
│   │   ├── metric_get_body_mock.go  # Моки для тестов обработчика получения
│   │   ├── metric_get_body_test.go  # Тесты обработчика получения метрик
│   │   ├── metric_list.go           # Обработчик списка метрик (HTML)
│   │   ├── metric_list_mock.go      # Моки для тестов списка метрик
│   │   ├── metric_list_test.go      # Тесты списка метрик
│   │   ├── metric_update_path.go    # Обработчик обновления метрик по URL пути
│   │   ├── metric_update_path_mock.go # Моки для тестов обновления
│   │   └── metric_update_path_test.go # Тесты обновления метрик
│   │   ├── metric_update_body.go    # Обработчик обновления метрик в теле
│   │   ├── metric_update_body_mock.go # Моки для тестов обновления
│   │   └── metric_update_body_test.go # Тесты обновления метрик
│   ├── logger                     # Подсистема логирования
│   │   ├── logger.go                # Инициализация и настройка логгера
│   │   └── logger_test.go           # Тесты подсистемы логирования
│   ├── middlewares                # Middlewares
│   │   ├── logging.go               # Логирование запросов и ответов сервера
│   │   └── logging_test.go          # Тесты логирование запросов и ответов сервера
│   │   ├── gzip.go                  # Сжатие и разжатие запросов и ответов сервера
│   │   └── gzip_test.go             # Тесты сжатия и разжатия запросов и ответов сервера
│   ├── repositories               # Репозитории — хранение и извлечение метрик
│   │   ├── metric_memory_get.go     # Получение метрик из памяти
│   │   ├── metric_memory_get_test.go# Тесты получения метрик из памяти
│   │   ├── metric_memory_list.go    # Получение списка метрик из памяти
│   │   ├── metric_memory_list_test.go # Тесты списка метрик
│   │   ├── metric_memory_save.go    # Сохранение метрик в память
│   │   └── metric_memory_save_test.go # Тесты сохранения метрик
│   ├── services                 # Бизнес-логика работы с метриками
│   │   ├── metric_get.go           # Логика получения метрик
│   │   ├── metric_get_mock.go      # Моки для сервиса получения
│   │   ├── metric_get_test.go      # Тесты сервиса получения метрик
│   │   ├── metric_list.go          # Логика формирования списка метрик
│   │   ├── metric_list_mock.go     # Моки для сервиса списка
│   │   ├── metric_list_test.go     # Тесты сервиса списка метрик
│   │   ├── metric_update.go        # Логика обновления метрик
│   │   ├── metric_update_mock.go   # Моки для сервиса обновления
│   │   └── metric_update_test.go   # Тесты обновления метрик
│   ├── types                   # Общие типы и структуры данных
│   │   ├── metrics.go              # Определения типов метрик
│   │   └── metrics_test.go         # Тесты типов метрик
│   └── workers                 # Воркеры — циклы сбора и отправки метрик
│       ├── metric_agent.go         # Воркер агента (сбор и отправка метрик)
│       ├── metric_agent_mock.go    # Моки для воркера агента
│       └── metric_agent_test.go    # Тесты воркера агента
|       ├── metric_server.go        # Воркер сервера (сбор и отправка метрик)
│       ├── metric_server_mock.go   # Моки для воркера сервера
│       └── metric_server_test.go   # Тесты воркера сервера
├── Makefile                      # Скрипты для сборки, тестирования и запуска
└── README.md                     # Документация проекта
```

---

## Используемые технологии

| Технология / Библиотека | Описание                              |
|-------------------------|-------------------------------------|
| Go                      | Язык программирования                |
| Chi                     | HTTP роутер                         |
| Resty                   | HTTP клиент                         |
| Testify                 | Фреймворк для тестирования          |

---

## Инкременты проекта

| Итерация | Описание                                               | Ссылка на PR                         |
|----------|--------------------------------------------------------|------------------------------------|
| iter1    | Реализация сервера сбора метрик с HTTP API             | https://github.com/sbilibin2017/yp-metrics/pull/1|
| iter2    | Реализация агента сбора метрик                         | https://github.com/sbilibin2017/yp-metrics/pull/2|
| iter3    | Добавление к серверу обработчиков дял поулчения метрик | https://github.com/sbilibin2017/yp-metrics/pull/3|
| iter4    | Добавление флагов для конфигурирования серва и агнта   | https://github.com/sbilibin2017/yp-metrics/pull/4|
| iter5    | Добавление приоритета конфигураций (env>flag>default)  | https://github.com/sbilibin2017/yp-metrics/pull/5|
| iter6    | Добавление logging middleware для логирования запросов и ответов сервера  | https://github.com/sbilibin2017/yp-metrics/pull/6|
| iter7    | Добавление обновление и получение метрик в теле запроса | https://github.com/sbilibin2017/yp-metrics/pull/7|
| iter8    | Добавление gzip middleware для зжатия/разжатия запросов/ответов | https://github.com/sbilibin2017/yp-metrics/pull/8|
| iter9    | Добавление загрузки и сохранения метрик сервером из файла | https://github.com/sbilibin2017/yp-metrics/pull/9|

---

## Развертывание проекта

1. Клонируйте репозиторий ```git clone git@github.com:sbilibin2017/yp-metrics.git```
2. Скомпилируйте сервер: ```go build -o ./cmd/server/server ./cmd/server/```
3. Скомпилируйте агент: ```go build -o ./cmd/agent/agent ./cmd/agent/```
4. Запустите сервер: ```./cmd/server/server```
5. Запустите агент: ```./cmd/agent/agent```