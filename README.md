# Яндекс Практикум "Продвинутый Go Разработчик"  
## Сервис сбора метрик и алертинга

## 📌 Описание проекта

Это система для сбора runtime-метрик, разработанная в рамках трека **«Сервис сбора метрик и алертинга»** курса **«Продвинутый Go-разработчик»** от Яндекс Практикума.  
Состоит из двух компонентов:

- **Сервер** — принимает и хранит метрики;
- **Агент** — собирает метрики из среды выполнения и отправляет их на сервер.

---

## ⚙️ Метрики

Поддерживаются два типа метрик:

- **gauge** (`float64`) — значение перезаписывается при каждом обновлении;
- **counter** (`int64`) — значение увеличивается на заданное при каждом обновлении.

---

## 🌐 Сервер

Сервер слушает `http://localhost:8080` и обрабатывает http запросы  

---

## 🛰 Агент

Агент предназначен для автоматического сбора метрик из стандартной библиотеки `runtime` и их периодической отправки на сервер.

### Что делает агент:

- Использует `runtime.ReadMemStats` для сбора метрик (`Alloc`, `TotalAlloc`, `Sys`, и др.);
- Обновляет значения `counter` метрик (например, количество попыток отправки);
- Отправляет данные на сервер с заданной периодичностью (`pollInterval`, `reportInterval`);
- Работает параллельно, используя `context.Context` и фоновые воркеры.

Агент можно запустить отдельно, указав адрес сервера и частоту опроса/отправки метрик через конфигурацию.

---

## Структура проекта

Проект имеет слоистую архитектуру, взаимодействие слоев осуществляется с помощью интерфейсов


```
.
├── cmd                               # Команды и точки входа в приложение
│   ├── agent                         # Клиент-агент для сбора и отправки метрик
│   │   ├── main.go                   # Точка входа агента
│   │   └── main_test.go              # Интеграционные тесты агента
│   └── server                        # Сервер сбора и хранения метрик
│       ├── main.go                   # Точка входа сервера
│       └── main_test.go              # Интеграционные тесты сервера
├── go.mod                            # Файл зависимостей Go-модуля
├── go.sum                            # Контрольные суммы для зависимостей
├── internal                          # Внутренние пакеты (неэкспортируемые за пределы модуля)
│   ├── configs                       # Конфигурации приложения (агента и сервера)
│   │   ├── agent.go                  # Конфигурация агента
│   │   ├── agent_test.go             # Тесты конфигурации агента
│   │   ├── server.go                 # Конфигурация сервера
│   │   └── server_test.go            # Тесты конфигурации сервера
│   ├── facades                       # Фасады — обёртки над внешними зависимостями
│   │   ├── metric_update.go          # Фасад отправки метрик от агента на сервер
│   │   └── metric_update_test.go     # Тесты фасада
│   ├── handlers                      # HTTP-обработчики входящих запросов
│   │   ├── metric_get_path.go        # Обработчик получения метрик по пути
│   │   ├── metric_get_path_mock.go   # Моки для тестов обработчиков
│   │   ├── metric_get_path_test.go   # Тесты обработчиков получения
│   │   ├── metric_list.go            # Обработчик списка всех метрик в HTML
│   │   ├── metric_list_mock.go       # Моки для тестов списка метрик
│   │   ├── metric_list_test.go       # Тесты списка метрик
│   │   ├── metric_update_path.go     # Обработчик обновления метрик через URL-путь
│   │   ├── metric_update_path_mock.go# Моки для тестов обновления
│   │   └── metric_update_path_test.go# Тесты обновления метрик
│   ├── logger                        # Подсистема логирования
│   │   ├── logger.go                 # Инициализация и настройка логгера
│   │   └── logger_test.go            # Тесты логгера
│   ├── repositories                  # Хранилища метрик
│   │   ├── metric_memory_get.go      # Репозиторий получения метрик из памяти
│   │   ├── metric_memory_get_test.go # Тесты получения метрик
│   │   ├── metric_memory_list.go     # Репозиторий списка всех метрик
│   │   ├── metric_memory_list_test.go# Тесты списка метрик
│   │   ├── metric_memory_save.go     # Репозиторий для сохранения метрик в памяти
│   │   └── metric_memory_save_test.go# Тесты сохранения метрик
│   ├── runners                       # Запуск компонентов (сервер, агент, воркеры)
│   │   ├── context.go                # Контекст выполнения с отменой
│   │   ├── context_test.go           # Тесты контекста
│   │   ├── http_server.go            # Запуск HTTP-сервера
│   │   ├── http_server_mock.go       # Моки HTTP-сервера
│   │   ├── http_server_test.go       # Тесты HTTP-сервера
│   │   ├── worker.go                 # Запуск фоновых воркеров
│   │   └── worker_test.go            # Тесты воркеров
│   ├── services                      # Бизнес-логика обработки метрик
│   │   ├── metric_get.go             # Логика получения метрик
│   │   ├── metric_get_mock.go        # Моки для сервиса получения
│   │   ├── metric_get_test.go        # Тесты получения метрик
│   │   ├── metric_list.go            # Логика формирования списка метрик
│   │   ├── metric_list_mock.go       # Моки для сервиса списка метрик
│   │   ├── metric_list_test.go       # Тесты списка метрик
│   │   ├── metric_update.go          # Логика обновления метрик
│   │   ├── metric_update_mock.go     # Моки для сервиса обновления
│   │   └── metric_update_test.go     # Тесты обновления метрик
│   ├── types                         # Общие типы и структуры
│   │   ├── metrics.go                # Типы метрик и их описание
│   │   └── metrics_test.go           # Тесты типов
│   └── workers                       # Воркеры — циклы опроса и отправки метрик
│       ├── metric_agent.go           # Воркер агента, собирающий и отправляющий метрики
│       ├── metric_agent_mock.go      # Моки воркера агента
│       └── metric_agent_test.go      # Тесты воркера агента
├── Makefile                          # Скрипты для сборки, тестирования и запуска
└── README.md                         # Документация проекта
```

---

## Используемые технологии

| Технология / Библиотека | Описание                              |
|-------------------------|-------------------------------------|
| Go                      | Язык программирования                |
| Chi                     | HTTP роутер                         |
| Resty                   | HTTP клиент                         |
| Testify                 | Фреймворк для тестирования          |

---

## Инкременты проекта

| Итерация | Описание                                               | Ссылка на PR                         |
|----------|--------------------------------------------------------|------------------------------------|
| iter1    | Реализация сервера сбора метрик с HTTP API             | https://github.com/sbilibin2017/yp-metrics/pull/1|
| iter2    | Реализация агента сбора метрик                         | https://github.com/sbilibin2017/yp-metrics/pull/2|
| iter3    | Добавление к серверу обработчиков дял поулчения метрик | https://github.com/sbilibin2017/yp-metrics/pull/3|

---

## Развертывание проекта

1. Клонируйте репозиторий ```git clone git@github.com:sbilibin2017/yp-metrics.git```
2. Скомпилируйте сервер: ```go build -o ./cmd/server/server ./cmd/server/```
3. Скомпилируйте агент: ```go build -o ./cmd/agent/agent ./cmd/agent/```
4. Запустите сервер: ```./cmd/server/server```
5. Запустите агент: ```./cmd/agent/agent```